---
title: 远程缓存
description: 了解如何使用 Turborepo 的远程缓存功能在整个团队中共享构建缓存，提高开发效率。
---

# 远程缓存

Turborepo 的[任务缓存](/docs/crafting-your-repository/caching)通过永不重复执行相同的工作来节省时间。

但是有一个问题：**缓存是本地存储在您的机器上的**。当您使用持续集成系统时，这可能导致大量重复工作：

![本地缓存在每个系统上创建缓存](/images/docs/local-caching-light.png)

由于 Turborepo 默认只缓存到本地文件系统，即使所有任务输入都相同，相同的任务（`turbo run build`）也必须**在每台机器上重新执行**（由您、您的队友、您的 CI、您的 PaaS 等）——这**浪费了时间和资源**。

::callout{type="info"}
您不必使用远程缓存就能使用 Turborepo。虽然远程缓存会带来最显著的速度提升，但您也可以在不使用远程缓存的情况下让现有工作流程更快。
::

## 单一共享缓存

如果您可以在整个团队（甚至您的 CI）中共享单个 Turborepo 缓存会怎样？

![远程缓存为整个团队创建共享缓存](/images/docs/remote-caching-light.png)

Turborepo 可以安全地与远程缓存通信——这是一个存储任务结果的云服务器。通过**防止整个组织中的重复工作**，这可以节省大量时间。

远程缓存是免费的，可以与[托管提供商](https://turborepo.com/docs/core-concepts/remote-caching#managed-remote-cache-with-vercel)一起使用，也可以作为[自托管缓存](https://turborepo.com/docs/core-concepts/remote-caching#self-hosting)使用。

::callout{type="warning"}
远程缓存是 Turborepo 的一个强大功能，但能力越大，责任越大。请确保您首先正确地进行缓存，并仔细检查[环境变量的处理](/docs/crafting-your-repository/using-environment-variables)。另外请记住，Turborepo 将日志视为构件，因此请注意您向控制台打印的内容。
::

## Vercel

[Vercel 远程缓存](https://vercel.com/docs/monorepos/remote-caching)在所有计划中都可以免费使用，即使您没有在 Vercel 上托管应用程序也是如此。按照以下步骤为您的仓库启用远程缓存。

### 本地开发

要将本地 Turborepo 链接到远程缓存，请使用您的 Vercel 账户验证 Turborepo CLI：

```bash title="Terminal"
turbo login
```

如果您没有安装[全局 `turbo`](/docs/getting-started/installation#global-installation)，也可以使用包管理器：

::code-group

```bash [pnpm]
pnpm dlx turbo login
```

```bash [yarn]
yarn dlx turbo login
```

```bash [npm]
npx turbo login
```

```bash [bun (Beta)]
bunx turbo login
```

::

::callout{type="info"}
如果您的远程缓存配置为使用单点登录，您需要运行 `npx turbo login --sso-team=team-name` 以获取具有正确权限的缓存令牌。
::

现在，将您的 Turborepo 链接到远程缓存：

```bash title="Terminal"
turbo link
```

启用后，对当前正在缓存的包进行一些更改，并使用 `turbo run` 对其运行任务。您的缓存构件现在将存储在本地_和_远程缓存中。

要验证，请删除本地 Turborepo 缓存：

::code-group

```bash [macOS/Linux]
rm -rf ./.turbo/cache
```

```bash [Windows]
rd /s /q "./.turbo/cache"
```

::

然后，再次运行相同的构建。如果一切正常工作，`turbo` 不应该在本地执行任务。相反，它将从远程缓存下载日志和构件，并将它们重放给您。

### Vercel 上的远程缓存

如果您在 Vercel 上构建和托管应用程序，一旦您使用 `turbo`，远程缓存将自动为您设置。有关更多信息，请参阅 [Vercel 文档](https://vercel.com/docs/concepts/monorepos/remote-caching?utm_source=turborepo.com&utm_medium=referral&utm_campaign=docs-link)。

### 构件完整性和真实性验证

Turborepo 可以在将构件上传到远程缓存之前使用密钥对其进行签名。Turborepo 使用您提供的密钥对构件使用 `HMAC-SHA256` 签名。当从远程缓存下载构件时，Turborepo 将验证其完整性和真实性。任何验证失败的构件将被忽略，并被 Turborepo 视为缓存未命中。

要启用此功能，请将 `turbo.json` 配置中的 `remoteCache` 选项设置为包含 `signature: true`。然后通过声明 `TURBO_REMOTE_CACHE_SIGNATURE_KEY` 环境变量来指定您的密钥。

```jsonc title="./turbo.json"
{
  "remoteCache": {
    "signature": true // [!code highlight]
  }
}
```

## 远程缓存 API

远程缓存可以由任何符合 Turborepo 远程缓存 API 规范的 HTTP 服务器实现。

### 使用 Vercel 的托管远程缓存

[Vercel](https://vercel.com)，Turborepo 的创建者和维护者，提供了一个与 Turborepo 完全兼容的托管远程缓存。

使用 [Vercel 远程缓存](https://vercel.com/docs/monorepos/remote-caching)是零配置的，并通过开源的 [Vercel 远程缓存 SDK](https://github.com/vercel/remote-cache) 自动与 [Vercel 部署](https://vercel.com/docs/deployments/overview)集成。

了解更多关于 [Vercel 上的 Turborepo](https://vercel.com/docs/monorepos/turborepo) 或[免费部署模板](https://vercel.com/templates?search=turborepo)来试用它。

### 自托管

您也可以自托管自己的远程缓存，并使用 `--manual` 标志登录以提供 API URL、团队和令牌信息。

```bash title="Terminal"
turbo login --manual
```

#### OpenAPI 规范

- [人类可读查看器](/docs/openapi)
- [JSON](/api/remote-cache-spec)

目前，所有版本的 `turbo` 都与 `v8` 端点兼容。

#### 社区实现

Turborepo 社区已经创建了远程缓存的开源实现。

- [`brunojppb/turbo-cache-server`](https://github.com/brunojppb/turbo-cache-server)
- [`ducktors/turborepo-remote-cache`](https://github.com/ducktors/turborepo-remote-cache)
- [`Tapico/tapico-turborepo-remote-cache`](https://github.com/Tapico/tapico-turborepo-remote-cache)
